<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fmx.xiaomeng.modules.application.repository.dao.ArticleDOMapper">
  <resultMap id="BaseResultMap" type="com.fmx.xiaomeng.modules.application.repository.model.ArticleDO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="content" jdbcType="VARCHAR" property="content" />
    <result column="img_url_list" jdbcType="VARCHAR" property="imgUrlList" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="modified_time" jdbcType="TIMESTAMP" property="modifiedTime" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="user_nick_name" jdbcType="VARCHAR" property="userNickName" />
    <result column="anonymous_name" jdbcType="VARCHAR" property="anonymousName" />
    <result column="avatar" jdbcType="VARCHAR" property="avatar" />
    <result column="category" jdbcType="INTEGER" property="category" />
    <result column="display_type" jdbcType="INTEGER" property="displayType" />
    <result column="function_type" jdbcType="INTEGER" property="functionType" />
    <result column="comment_count" jdbcType="INTEGER" property="commentCount" />
    <result column="thumb_up_count" jdbcType="INTEGER" property="thumbUpCount" />
    <result column="view_count" jdbcType="INTEGER" property="viewCount" />
    <result column="collect_count" jdbcType="INTEGER" property="collectCount" />
    <result column="top" jdbcType="BIT" property="top" />
    <result column="good" jdbcType="BIT" property="good" />
    <result column="tag" jdbcType="VARCHAR" property="tag" />
    <result column="thumb_up_ids" jdbcType="VARCHAR" property="thumbUpIds" />
    <result column="school_id" jdbcType="INTEGER" property="schoolId" />
    <result column="anonymous" jdbcType="BIT" property="anonymous" />
    <result column="has_delete" jdbcType="BIT" property="hasDelete" />
    <result column="hot" jdbcType="BIGINT" property="hot" />
    <result column="position_info" jdbcType="VARCHAR" property="positionInfo" />
    <result column="admin" jdbcType="BIT" property="admin" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    id, title, content, img_url_list, create_time, modified_time, user_id, user_nick_name,
    anonymous_name, avatar, category, display_type, function_type, comment_count, thumb_up_count,
    view_count, collect_count, top, good, tag, thumb_up_ids, school_id, anonymous, has_delete,
    hot, position_info, admin
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    select
    <include refid="Base_Column_List" />
    from article
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    delete from article
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.fmx.xiaomeng.modules.application.repository.model.ArticleDO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into article (title, content, img_url_list,
      create_time, modified_time, user_id,
      user_nick_name, anonymous_name, avatar,
      category, display_type, function_type,
      comment_count, thumb_up_count, view_count,
      collect_count, top, good, tag,
      thumb_up_ids, school_id, anonymous,
      has_delete, hot, position_info,
      admin)
    values (#{title,jdbcType=VARCHAR}, #{content,jdbcType=VARCHAR}, #{imgUrlList,jdbcType=VARCHAR},
      #{createTime,jdbcType=TIMESTAMP}, #{modifiedTime,jdbcType=TIMESTAMP}, #{userId,jdbcType=BIGINT},
      #{userNickName,jdbcType=VARCHAR}, #{anonymousName,jdbcType=VARCHAR}, #{avatar,jdbcType=VARCHAR},
      #{category,jdbcType=INTEGER}, #{displayType,jdbcType=INTEGER}, #{functionType,jdbcType=INTEGER},
      #{commentCount,jdbcType=INTEGER}, #{thumbUpCount,jdbcType=INTEGER}, #{viewCount,jdbcType=INTEGER},
      #{collectCount,jdbcType=INTEGER}, #{top,jdbcType=BIT}, #{good,jdbcType=BIT}, #{tag,jdbcType=VARCHAR},
      #{thumbUpIds,jdbcType=VARCHAR}, #{schoolId,jdbcType=INTEGER}, #{anonymous,jdbcType=BIT},
      #{hasDelete,jdbcType=BIT}, #{hot,jdbcType=BIGINT}, #{positionInfo,jdbcType=VARCHAR},
      #{admin,jdbcType=BIT})
  </insert>
  <insert id="insertSelective" parameterType="com.fmx.xiaomeng.modules.application.repository.model.ArticleDO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into article
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="title != null">
        title,
      </if>
      <if test="content != null">
        content,
      </if>
      <if test="imgUrlList != null">
        img_url_list,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="modifiedTime != null">
        modified_time,
      </if>
      <if test="userId != null">
        user_id,
      </if>
      <if test="userNickName != null">
        user_nick_name,
      </if>
      <if test="anonymousName != null">
        anonymous_name,
      </if>
      <if test="avatar != null">
        avatar,
      </if>
      <if test="category != null">
        category,
      </if>
      <if test="displayType != null">
        display_type,
      </if>
      <if test="functionType != null">
        function_type,
      </if>
      <if test="commentCount != null">
        comment_count,
      </if>
      <if test="thumbUpCount != null">
        thumb_up_count,
      </if>
      <if test="viewCount != null">
        view_count,
      </if>
      <if test="collectCount != null">
        collect_count,
      </if>
      <if test="top != null">
        top,
      </if>
      <if test="good != null">
        good,
      </if>
      <if test="tag != null">
        tag,
      </if>
      <if test="thumbUpIds != null">
        thumb_up_ids,
      </if>
      <if test="schoolId != null">
        school_id,
      </if>
      <if test="anonymous != null">
        anonymous,
      </if>
      <if test="hasDelete != null">
        has_delete,
      </if>
      <if test="hot != null">
        hot,
      </if>
      <if test="positionInfo != null">
        position_info,
      </if>
      <if test="admin != null">
        admin,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="title != null">
        #{title,jdbcType=VARCHAR},
      </if>
      <if test="content != null">
        #{content,jdbcType=VARCHAR},
      </if>
      <if test="imgUrlList != null">
        #{imgUrlList,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifiedTime != null">
        #{modifiedTime,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null">
        #{userId,jdbcType=BIGINT},
      </if>
      <if test="userNickName != null">
        #{userNickName,jdbcType=VARCHAR},
      </if>
      <if test="anonymousName != null">
        #{anonymousName,jdbcType=VARCHAR},
      </if>
      <if test="avatar != null">
        #{avatar,jdbcType=VARCHAR},
      </if>
      <if test="category != null">
        #{category,jdbcType=INTEGER},
      </if>
      <if test="displayType != null">
        #{displayType,jdbcType=INTEGER},
      </if>
      <if test="functionType != null">
        #{functionType,jdbcType=INTEGER},
      </if>
      <if test="commentCount != null">
        #{commentCount,jdbcType=INTEGER},
      </if>
      <if test="thumbUpCount != null">
        #{thumbUpCount,jdbcType=INTEGER},
      </if>
      <if test="viewCount != null">
        #{viewCount,jdbcType=INTEGER},
      </if>
      <if test="collectCount != null">
        #{collectCount,jdbcType=INTEGER},
      </if>
      <if test="top != null">
        #{top,jdbcType=BIT},
      </if>
      <if test="good != null">
        #{good,jdbcType=BIT},
      </if>
      <if test="tag != null">
        #{tag,jdbcType=VARCHAR},
      </if>
      <if test="thumbUpIds != null">
        #{thumbUpIds,jdbcType=VARCHAR},
      </if>
      <if test="schoolId != null">
        #{schoolId,jdbcType=INTEGER},
      </if>
      <if test="anonymous != null">
        #{anonymous,jdbcType=BIT},
      </if>
      <if test="hasDelete != null">
        #{hasDelete,jdbcType=BIT},
      </if>
      <if test="hot != null">
        #{hot,jdbcType=BIGINT},
      </if>
      <if test="positionInfo != null">
        #{positionInfo,jdbcType=VARCHAR},
      </if>
      <if test="admin != null">
        #{admin,jdbcType=BIT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.fmx.xiaomeng.modules.application.repository.model.ArticleDO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    update article
    <set>
      <if test="title != null">
        title = #{title,jdbcType=VARCHAR},
      </if>
      <if test="content != null">
        content = #{content,jdbcType=VARCHAR},
      </if>
      <if test="imgUrlList != null">
        img_url_list = #{imgUrlList,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifiedTime != null">
        modified_time = #{modifiedTime,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null">
        user_id = #{userId,jdbcType=BIGINT},
      </if>
      <if test="userNickName != null">
        user_nick_name = #{userNickName,jdbcType=VARCHAR},
      </if>
      <if test="anonymousName != null">
        anonymous_name = #{anonymousName,jdbcType=VARCHAR},
      </if>
      <if test="avatar != null">
        avatar = #{avatar,jdbcType=VARCHAR},
      </if>
      <if test="category != null">
        category = #{category,jdbcType=INTEGER},
      </if>
      <if test="displayType != null">
        display_type = #{displayType,jdbcType=INTEGER},
      </if>
      <if test="functionType != null">
        function_type = #{functionType,jdbcType=INTEGER},
      </if>
      <if test="commentCount != null">
        comment_count = #{commentCount,jdbcType=INTEGER},
      </if>
      <if test="thumbUpCount != null">
        thumb_up_count = #{thumbUpCount,jdbcType=INTEGER},
      </if>
      <if test="viewCount != null">
        view_count = #{viewCount,jdbcType=INTEGER},
      </if>
      <if test="collectCount != null">
        collect_count = #{collectCount,jdbcType=INTEGER},
      </if>
      <if test="top != null">
        top = #{top,jdbcType=BIT},
      </if>
      <if test="good != null">
        good = #{good,jdbcType=BIT},
      </if>
      <if test="tag != null">
        tag = #{tag,jdbcType=VARCHAR},
      </if>
      <if test="thumbUpIds != null">
        thumb_up_ids = #{thumbUpIds,jdbcType=VARCHAR},
      </if>
      <if test="schoolId != null">
        school_id = #{schoolId,jdbcType=INTEGER},
      </if>
      <if test="anonymous != null">
        anonymous = #{anonymous,jdbcType=BIT},
      </if>
      <if test="hasDelete != null">
        has_delete = #{hasDelete,jdbcType=BIT},
      </if>
      <if test="hot != null">
        hot = #{hot,jdbcType=BIGINT},
      </if>
      <if test="positionInfo != null">
        position_info = #{positionInfo,jdbcType=VARCHAR},
      </if>
      <if test="admin != null">
        admin = #{admin,jdbcType=BIT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.fmx.xiaomeng.modules.application.repository.model.ArticleDO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Nov 23 02:04:07 CST 2024.
    -->
    update article
    set title = #{title,jdbcType=VARCHAR},
      content = #{content,jdbcType=VARCHAR},
      img_url_list = #{imgUrlList,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      modified_time = #{modifiedTime,jdbcType=TIMESTAMP},
      user_id = #{userId,jdbcType=BIGINT},
      user_nick_name = #{userNickName,jdbcType=VARCHAR},
      anonymous_name = #{anonymousName,jdbcType=VARCHAR},
      avatar = #{avatar,jdbcType=VARCHAR},
      category = #{category,jdbcType=INTEGER},
      display_type = #{displayType,jdbcType=INTEGER},
      function_type = #{functionType,jdbcType=INTEGER},
      comment_count = #{commentCount,jdbcType=INTEGER},
      thumb_up_count = #{thumbUpCount,jdbcType=INTEGER},
      view_count = #{viewCount,jdbcType=INTEGER},
      collect_count = #{collectCount,jdbcType=INTEGER},
      top = #{top,jdbcType=BIT},
      good = #{good,jdbcType=BIT},
      tag = #{tag,jdbcType=VARCHAR},
      thumb_up_ids = #{thumbUpIds,jdbcType=VARCHAR},
      school_id = #{schoolId,jdbcType=INTEGER},
      anonymous = #{anonymous,jdbcType=BIT},
      has_delete = #{hasDelete,jdbcType=BIT},
      hot = #{hot,jdbcType=BIGINT},
      position_info = #{positionInfo,jdbcType=VARCHAR},
      admin = #{admin,jdbcType=BIT}
    where id = #{id,jdbcType=BIGINT}
  </update>


  <select id="countByParam" resultType="long">
    select count(*) from article
    <where>
      has_delete = false
      <if test="null != top">
        and top = #{top,jdbcType=INTEGER}
      </if>
      <if test="null != schoolId">
        and school_id = #{schoolId,jdbcType=INTEGER}
      </if>
      <if test="null != anonymous">
        and anonymous = #{anonymous,jdbcType=BIT}
      </if>
      <if test="null != category">
        and category = #{category,jdbcType=INTEGER}
      </if>
      <if test="null != functionType">
        and function_type = #{functionType,jdbcType=INTEGER}
      </if>
      <if test="null != userId">
        and user_id = #{userId,jdbcType=BIGINT}
      </if>
      <if test="null != keyword and '' != keyword">
        and (title like concat('%',#{keyword},'%') or content like concat('%',#{keyword},'%'))
      </if>
    </where>
  </select>
  <select id="pageQuery" resultMap="BaseResultMap">
    select * from article
    <where>
      has_delete = false
      <if test="null != top">
        and top = #{top,jdbcType=INTEGER}
      </if>
      <if test="null != schoolId">
        and school_id = #{schoolId,jdbcType=INTEGER}
      </if>
      <if test="null != anonymous">
        and anonymous = #{anonymous,jdbcType=BIT}
      </if>
      <if test="null != category">
        and category = #{category,jdbcType=INTEGER}
      </if>
      <if test="null != functionType">
        and function_type = #{functionType,jdbcType=INTEGER}
      </if>
      <if test="null != userId">
        and user_id = #{userId,jdbcType=BIGINT}
      </if>
      <if test="null != keyword and '' != keyword">
        and (title like concat('%',#{keyword},'%') or content like concat('%',#{keyword},'%'))
      </if>
    </where>

    <if test="'time' == order">
      order by create_time desc
    </if>
    <if test="'hot' == order">
      order by hot desc
    </if>

    LIMIT #{pageParam.size} OFFSET #{pageParam.offset}
  </select>



  <select id="topArticle" resultMap="BaseResultMap">
    select * from article
    where
    has_delete = false
    and top = 1
    <if test="null != schoolId">
      and school_id = #{schoolId,jdbcType=INTEGER}
    </if>
    order by create_time desc
   ;
  </select>
  <select id="topTenDay" resultMap="BaseResultMap">
    select * from article
    where
    has_delete = false
    and top = 0
    and school_id = #{schoolId,jdbcType=INTEGER}
    and create_time &gt; DATE_SUB(NOW(), INTERVAL 24 HOUR)
    and function_type in (1,2,3,4)
    order by hot desc
    limit 10;
  </select>
  <select id="topTenWeek" resultMap="BaseResultMap">
    select * from article
    where
     has_delete = false
     and top = 0
    and school_id = #{schoolId,jdbcType=INTEGER}
    and create_time &gt; DATE_SUB(CURDATE(), INTERVAL 7 DAY)
    and function_type in (1,2,3,4)
    and anonymous = false
    order by hot desc
    limit 10;
  </select>
  <select id="topTenMonth" resultMap="BaseResultMap">
    select * from article
    where
    has_delete = false
    and top = 0
    and school_id = #{schoolId,jdbcType=INTEGER}
    and create_time &gt; DATE_SUB(CURDATE(), INTERVAL 30 DAY)
    and function_type in (1,2,3,4)
    and anonymous = false
    order by hot desc
    limit 10;
  </select>


  <update id="setTop">
    update article set top = 1 where id = #{articleId,jdbcType=INTEGER};
  </update>

  <update id="cancelTop">
    update article set top = 0 where id = #{articleId,jdbcType=INTEGER};
  </update>

  <update id="plusThumbUpCount">
    update article set hot = hot+20, thumb_up_count = thumb_up_count+1 where id = #{articleId,jdbcType=BIGINT};
  </update>
  <update id="minusThumbUpCount">
    update article set hot = hot-20, thumb_up_count = thumb_up_count-1 where id = #{articleId,jdbcType=BIGINT};
  </update>
  <update id="plusViewCount">
    update article set hot = hot+ #{count,jdbcType=INTEGER},view_count = view_count+#{randomCount,jdbcType=INTEGER} where id = #{articleId,jdbcType=BIGINT};
  </update>

  <update id="plusCollectCount">
    update article set collect_count = collect_count + 1 where id = #{articleId,jdbcType=INTEGER};
  </update>
  <update id="minusCollectCount">
    update article set collect_count = collect_count - 1 where id = #{articleId,jdbcType=INTEGER};
  </update>

  <update id="plusCommentCount">
    update article set hot = hot+100,comment_count = comment_count + 1 where id = #{articleId,jdbcType=INTEGER};
  </update>

  <update id="delete">
    update article
    set has_delete = true
    where id = #{articleId,jdbcType=BIGINT}
  </update>

  <update id="updateMyArticleNoAnonymous">
    update article
    <set>
      <if test="avatar != null">
        avatar = #{avatar,jdbcType=VARCHAR},
      </if>
      <if test="userNickName != null">
        user_nick_name = #{userNickName,jdbcType=VARCHAR},
      </if>
    </set>
    where user_id = #{userId,jdbcType=BIGINT}
    and anonymous = false
  </update>


  <select id="scan" resultMap="BaseResultMap">
    select * from article
  </select>

  <select id="queryWxGroupArticleInfo" resultMap="BaseResultMap">
  select id, content, category, create_time from article
  <where>
    has_delete = false
    <if test="startTime != null">
      and create_time &gt; #{startTime,jdbcType=TIMESTAMP}
    </if>
    <if test="null != schoolId">
      and school_id = #{schoolId,jdbcType=INTEGER}
    </if>
  </where>
    order by create_time desc
  </select>
    <select id="countTodayArticleNum" resultType="java.lang.Long">
      select count(*)
      from article
      <where>
        has_delete = false
        and create_time &gt;= CURDATE()
        <if test="schoolId != null">
          and school_id = #{schoolId,jdbcType=TIMESTAMP}
        </if>
      </where>
    </select>

  <select id="countYesterdayArticleNum" resultType="java.lang.Long">
    select count(*)
    from article
    <where>
      has_delete = false
      and create_time &gt;= DATE_SUB(CURDATE(), INTERVAL 1 DAY)
      and create_time &lt; CURDATE()
      <if test="schoolId != null">
        and school_id = #{schoolId,jdbcType=TIMESTAMP}
      </if>
    </where>
  </select>
</mapper>
